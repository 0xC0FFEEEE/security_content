---
title: "System Process Running from Unexpected Location"
excerpt: "Masquerading"
categories:
  - Endpoint
last_modified_at: 2020-08-25
toc: true
tags:
  - Anomaly
  - T1036
  - Masquerading
  - Defense Evasion
  - Splunk Behavioral Analytics
  - Actions on Objectives
---

# System Process Running from Unexpected Location

An attacker tries might try to use different version of a system command without overriding original, or they might try to avoid some detection running the process from a different folder. This detection checks that a list of system processes run inside C:\\Windows\System32 or C:\\Windows\SysWOW64 The list of system processes has been extracted from https://github.com/splunk/security_content/blob/develop/lookups/is_windows_system_file.csv and the original detection https://github.com/splunk/security_content/blob/develop/detections/system_processes_run_from_unexpected_locations.yml

- **Product**: Splunk Behavioral Analytics
- **Datamodel**:
- **ATT&CK**: [T1036](https://attack.mitre.org/techniques/T1036/)
- **Last Updated**: 2020-08-25
- **Author**: Ignacio Bermudez Corrales, Splunk


#### ATT&CK

| ID          | Technique   | Tactic       |
| ----------- | ----------- |--------------|
| T1036 | Masquerading | Defense Evasion |


#### Search

```
 $ssa_input = 
| from read_ssa_enriched_events() 
| eval device=ucast(map_get(input_event, &#34;dest_device_id&#34;), &#34;string&#34;, null), user=ucast(map_get(input_event, &#34;dest_user_id&#34;), &#34;string&#34;, null), timestamp=parse_long(ucast(map_get(input_event, &#34;_time&#34;), &#34;string&#34;, null)), process_name=lower(ucast(map_get(input_event, &#34;process_name&#34;), &#34;string&#34;, null)), process_path=lower(ucast(map_get(input_event, &#34;process_path&#34;), &#34;string&#34;, null)), event_id=ucast(map_get(input_event, &#34;event_id&#34;), &#34;string&#34;, null);
$cond_1 = 
| from $ssa_input 
| where process_name=&#34;arp.exe&#34; OR process_name=&#34;adaptertroubleshooter.exe&#34; OR process_name=&#34;applicationframehost.exe&#34; OR process_name=&#34;atbroker.exe&#34; OR process_name=&#34;authhost.exe&#34; OR process_name=&#34;autoworkplace.exe&#34; OR process_name=&#34;axinstui.exe&#34; OR process_name=&#34;backgroundtransferhost.exe&#34; OR process_name=&#34;bdehdcfg.exe&#34; OR process_name=&#34;bdeuisrv.exe&#34; OR process_name=&#34;bdeunlockwizard.exe&#34; OR process_name=&#34;bitlockerdeviceencryption.exe&#34; OR process_name=&#34;bitlockerwizard.exe&#34; OR process_name=&#34;bitlockerwizardelev.exe&#34; OR process_name=&#34;bytecodegenerator.exe&#34; OR process_name=&#34;camerasettingsuihost.exe&#34; OR process_name=&#34;castsrv.exe&#34; OR process_name=&#34;certenrollctrl.exe&#34; OR process_name=&#34;checknetisolation.exe&#34; OR process_name=&#34;clipup.exe&#34; OR process_name=&#34;cloudexperiencehostbroker.exe&#34; OR process_name=&#34;cloudnotifications.exe&#34; OR process_name=&#34;cloudstoragewizard.exe&#34; OR process_name=&#34;compmgmtlauncher.exe&#34; OR process_name=&#34;compattelrunner.exe&#34; OR process_name=&#34;computerdefaults.exe&#34; OR process_name=&#34;credentialuibroker.exe&#34; OR process_name=&#34;dfdwiz.exe&#34; OR process_name=&#34;dwwin.exe&#34; OR process_name=&#34;dataexchangehost.exe&#34; OR process_name=&#34;defrag.exe&#34; OR process_name=&#34;devicedisplayobjectprovider.exe&#34; OR process_name=&#34;deviceeject.exe&#34; OR process_name=&#34;deviceenroller.exe&#34; OR process_name=&#34;devicepairingwizard.exe&#34; OR process_name=&#34;deviceproperties.exe&#34; OR process_name=&#34;disksnapshot.exe&#34; OR process_name=&#34;dism.exe&#34; OR process_name=&#34;displayswitch.exe&#34; OR process_name=&#34;dmnotificationbroker.exe&#34; OR process_name=&#34;dmomacpmo.exe&#34; OR process_name=&#34;dpiscaling.exe&#34; OR process_name=&#34;dsmusertask.exe&#34; OR process_name=&#34;dxpserver.exe&#34; OR process_name=&#34;edpcleanup.exe&#34; OR process_name=&#34;eosnotify.exe&#34; OR process_name=&#34;eap3host.exe&#34; OR process_name=&#34;easpoliciesbrokerhost.exe&#34; OR process_name=&#34;easeofaccessdialog.exe&#34; OR process_name=&#34;ehstorauthn.exe&#34; OR process_name=&#34;fxscover.exe&#34; OR process_name=&#34;fxssvc.exe&#34; OR process_name=&#34;fxsunatd.exe&#34; OR process_name=&#34;filehistory.exe&#34; OR process_name=&#34;fondue.exe&#34; OR process_name=&#34;gamepanel.exe&#34; OR process_name=&#34;genvalobj.exe&#34; OR process_name=&#34;gettingstarted.exe&#34; OR process_name=&#34;hostname.exe&#34; OR process_name=&#34;icsentitlementhost.exe&#34; OR process_name=&#34;infdefaultinstall.exe&#34; OR process_name=&#34;installagent.exe&#34; OR process_name=&#34;languagecomponentsinstallercomhandler.exe&#34; OR process_name=&#34;launchtm.exe&#34; OR process_name=&#34;launchwinapp.exe&#34; OR process_name=&#34;legacynetuxhost.exe&#34; OR process_name=&#34;licensemanagershellext.exe&#34; OR process_name=&#34;licensingui.exe&#34; OR process_name=&#34;locationnotificationwindows.exe&#34; OR process_name=&#34;locationnotifications.exe&#34; OR process_name=&#34;locator.exe&#34; OR process_name=&#34;lockapphost.exe&#34; OR process_name=&#34;lockscreencontentserver.exe&#34; OR process_name=&#34;logonui.exe&#34; OR process_name=&#34;lsaiso.exe&#34; OR process_name=&#34;mdeserver.exe&#34; OR process_name=&#34;mdmagent.exe&#34; OR process_name=&#34;mdmappinstaller.exe&#34; OR process_name=&#34;mrinfo.exe&#34; OR process_name=&#34;mrt.exe&#34; OR process_name=&#34;mschedexe.exe&#34; OR process_name=&#34;magnify.exe&#34; OR process_name=&#34;mbaeparsertask.exe&#34; OR process_name=&#34;mdres.exe&#34; OR process_name=&#34;mdsched.exe&#34; OR process_name=&#34;migautoplay.exe&#34; OR process_name=&#34;mpsigstub.exe&#34; OR process_name=&#34;msspellcheckinghost.exe&#34; OR process_name=&#34;muiunattend.exe&#34; OR process_name=&#34;multidigimon.exe&#34; OR process_name=&#34;musnotification.exe&#34; OR process_name=&#34;musnotificationux.exe&#34; OR process_name=&#34;napstat.exe&#34; OR process_name=&#34;netstat.exe&#34; OR process_name=&#34;narrator.exe&#34; OR process_name=&#34;netcfgnotifyobjecthost.exe&#34; OR process_name=&#34;netevtfwdr.exe&#34; OR process_name=&#34;netproj.exe&#34; OR process_name=&#34;netplwiz.exe&#34; OR process_name=&#34;networkuxbroker.exe&#34;;
$cond_2 = 
| from $ssa_input 
| where process_name=&#34;openwith.exe&#34; OR process_name=&#34;optionalfeatures.exe&#34; OR process_name=&#34;pathping.exe&#34; OR process_name=&#34;ping.exe&#34; OR process_name=&#34;passwordonwakesettingflyout.exe&#34; OR process_name=&#34;pickerhost.exe&#34; OR process_name=&#34;pkgmgr.exe&#34; OR process_name=&#34;pnpunattend.exe&#34; OR process_name=&#34;pnputil.exe&#34; OR process_name=&#34;presentationhost.exe&#34; OR process_name=&#34;presentationsettings.exe&#34; OR process_name=&#34;printbrmui.exe&#34; OR process_name=&#34;printdialoghost.exe&#34; OR process_name=&#34;printdialoghost3d.exe&#34; OR process_name=&#34;printisolationhost.exe&#34; OR process_name=&#34;proximityuxhost.exe&#34; OR process_name=&#34;rdspnf.exe&#34; OR process_name=&#34;rmactivate.exe&#34; OR process_name=&#34;rmactivate_isv.exe&#34; OR process_name=&#34;rmactivate_ssp.exe&#34; OR process_name=&#34;rmactivate_ssp_isv.exe&#34; OR process_name=&#34;route.exe&#34; OR process_name=&#34;rdpsa.exe&#34; OR process_name=&#34;rdpsaproxy.exe&#34; OR process_name=&#34;rdpsauachelper.exe&#34; OR process_name=&#34;reagentc.exe&#34; OR process_name=&#34;recoverydrive.exe&#34; OR process_name=&#34;register-cimprovider.exe&#34; OR process_name=&#34;registeriepkeys.exe&#34; OR process_name=&#34;relpost.exe&#34; OR process_name=&#34;remoteposworker.exe&#34; OR process_name=&#34;rmclient.exe&#34; OR process_name=&#34;robocopy.exe&#34; OR process_name=&#34;rpcping.exe&#34; OR process_name=&#34;runlegacycplelevated.exe&#34; OR process_name=&#34;runtimebroker.exe&#34; OR process_name=&#34;sihclient.exe&#34; OR process_name=&#34;searchfilterhost.exe&#34; OR process_name=&#34;searchindexer.exe&#34; OR process_name=&#34;searchprotocolhost.exe&#34; OR process_name=&#34;secedit.exe&#34; OR process_name=&#34;sensordataservice.exe&#34; OR process_name=&#34;setieinstalleddate.exe&#34; OR process_name=&#34;settingsynchost.exe&#34; OR process_name=&#34;slidetoshutdown.exe&#34; OR process_name=&#34;smartscreensettings.exe&#34; OR process_name=&#34;sndvol.exe&#34; OR process_name=&#34;snippingtool.exe&#34; OR process_name=&#34;soundrecorder.exe&#34; OR process_name=&#34;spaceagent.exe&#34; OR process_name=&#34;sppextcomobj.exe&#34; OR process_name=&#34;srtasks.exe&#34; OR process_name=&#34;stikynot.exe&#34; OR process_name=&#34;synchost.exe&#34; OR process_name=&#34;sysreseterr.exe&#34; OR process_name=&#34;systempropertiesadvanced.exe&#34; OR process_name=&#34;systempropertiescomputername.exe&#34; OR process_name=&#34;systempropertiesdataexecutionprevention.exe&#34; OR process_name=&#34;systempropertieshardware.exe&#34; OR process_name=&#34;systempropertiesperformance.exe&#34; OR process_name=&#34;systempropertiesprotection.exe&#34; OR process_name=&#34;systempropertiesremote.exe&#34; OR process_name=&#34;systemsettingsadminflows.exe&#34; OR process_name=&#34;systemsettingsbroker.exe&#34; OR process_name=&#34;systemsettingsremovedevice.exe&#34; OR process_name=&#34;tcpsvcs.exe&#34; OR process_name=&#34;tracert.exe&#34; OR process_name=&#34;tstheme.exe&#34; OR process_name=&#34;tswbprxy.exe&#34; OR process_name=&#34;tapiunattend.exe&#34; OR process_name=&#34;taskmgr.exe&#34; OR process_name=&#34;thumbnailextractionhost.exe&#34; OR process_name=&#34;tokenbrokercookies.exe&#34; OR process_name=&#34;tpminit.exe&#34; OR process_name=&#34;tswpfwrp.exe&#34; OR process_name=&#34;ui0detect.exe&#34; OR process_name=&#34;upgraderesultsui.exe&#34; OR process_name=&#34;useraccountbroker.exe&#34; OR process_name=&#34;useraccountcontrolsettings.exe&#34; OR process_name=&#34;usoclient.exe&#34; OR process_name=&#34;utilman.exe&#34; OR process_name=&#34;vssvc.exe&#34; OR process_name=&#34;vaultcmd.exe&#34; OR process_name=&#34;vaultsysui.exe&#34; OR process_name=&#34;wfs.exe&#34; OR process_name=&#34;wmpdmc.exe&#34; OR process_name=&#34;wpdshextautoplay.exe&#34; OR process_name=&#34;wscollect.exe&#34; OR process_name=&#34;wsmanhttpconfig.exe&#34; OR process_name=&#34;wsreset.exe&#34; OR process_name=&#34;wudfhost.exe&#34; OR process_name=&#34;wwahost.exe&#34; OR process_name=&#34;wallpaperhost.exe&#34; OR process_name=&#34;webcache.exe&#34; OR process_name=&#34;werfault.exe&#34; OR process_name=&#34;werfaultsecure.exe&#34; OR process_name=&#34;winsat.exe&#34; OR process_name=&#34;windows.media.backgroundplayback.exe&#34; OR process_name=&#34;windowsactiondialog.exe&#34; OR process_name=&#34;windowsanytimeupgrade.exe&#34; OR process_name=&#34;windowsanytimeupgraderesults.exe&#34;;
$cond_3 = 
| from $ssa_input 
| where process_name=&#34;windowsanytimeupgradeui.exe&#34; OR process_name=&#34;windowsupdateelevatedinstaller.exe&#34; OR process_name=&#34;workfolders.exe&#34; OR process_name=&#34;wpcmon.exe&#34; OR process_name=&#34;acu.exe&#34; OR process_name=&#34;aitagent.exe&#34; OR process_name=&#34;aitstatic.exe&#34; OR process_name=&#34;alg.exe&#34; OR process_name=&#34;appidcertstorecheck.exe&#34; OR process_name=&#34;appidpolicyconverter.exe&#34; OR process_name=&#34;at.exe&#34; OR process_name=&#34;attrib.exe&#34; OR process_name=&#34;audiodg.exe&#34; OR process_name=&#34;auditpol.exe&#34; OR process_name=&#34;autochk.exe&#34; OR process_name=&#34;autoconv.exe&#34; OR process_name=&#34;autofmt.exe&#34; OR process_name=&#34;baaupdate.exe&#34; OR process_name=&#34;backgroundtaskhost.exe&#34; OR process_name=&#34;bcastdvr.exe&#34; OR process_name=&#34;bcdboot.exe&#34; OR process_name=&#34;bcdedit.exe&#34; OR process_name=&#34;bdechangepin.exe&#34; OR process_name=&#34;bdeunlock.exe&#34; OR process_name=&#34;bitsadmin.exe&#34; OR process_name=&#34;bootcfg.exe&#34; OR process_name=&#34;bootim.exe&#34; OR process_name=&#34;bootsect.exe&#34; OR process_name=&#34;bridgeunattend.exe&#34; OR process_name=&#34;browser_broker.exe&#34; OR process_name=&#34;bthudtask.exe&#34; OR process_name=&#34;cacls.exe&#34; OR process_name=&#34;calc.exe&#34; OR process_name=&#34;cdpreference.exe&#34; OR process_name=&#34;certreq.exe&#34; OR process_name=&#34;certutil.exe&#34; OR process_name=&#34;change.exe&#34; OR process_name=&#34;changepk.exe&#34; OR process_name=&#34;charmap.exe&#34; OR process_name=&#34;chglogon.exe&#34; OR process_name=&#34;chgport.exe&#34; OR process_name=&#34;chgusr.exe&#34; OR process_name=&#34;chkdsk.exe&#34; OR process_name=&#34;chkntfs.exe&#34; OR process_name=&#34;choice.exe&#34; OR process_name=&#34;cipher.exe&#34; OR process_name=&#34;cleanmgr.exe&#34; OR process_name=&#34;cliconfg.exe&#34; OR process_name=&#34;clip.exe&#34; OR process_name=&#34;cmd.exe&#34; OR process_name=&#34;cmdkey.exe&#34; OR process_name=&#34;cmdl32.exe&#34; OR process_name=&#34;cmmon32.exe&#34; OR process_name=&#34;cmstp.exe&#34; OR process_name=&#34;cofire.exe&#34; OR process_name=&#34;colorcpl.exe&#34; OR process_name=&#34;comp.exe&#34; OR process_name=&#34;compact.exe&#34; OR process_name=&#34;conhost.exe&#34; OR process_name=&#34;consent.exe&#34; OR process_name=&#34;control.exe&#34; OR process_name=&#34;convert.exe&#34; OR process_name=&#34;credwiz.exe&#34; OR process_name=&#34;cscript.exe&#34; OR process_name=&#34;csrss.exe&#34; OR process_name=&#34;ctfmon.exe&#34; OR process_name=&#34;cttune.exe&#34; OR process_name=&#34;cttunesvr.exe&#34; OR process_name=&#34;dashost.exe&#34; OR process_name=&#34;dccw.exe&#34; OR process_name=&#34;dcomcnfg.exe&#34; OR process_name=&#34;ddodiag.exe&#34; OR process_name=&#34;dfrgui.exe&#34; OR process_name=&#34;dialer.exe&#34; OR process_name=&#34;diantz.exe&#34; OR process_name=&#34;dinotify.exe&#34; OR process_name=&#34;diskpart.exe&#34; OR process_name=&#34;diskperf.exe&#34; OR process_name=&#34;diskraid.exe&#34; OR process_name=&#34;dispdiag.exe&#34; OR process_name=&#34;djoin.exe&#34; OR process_name=&#34;dllhost.exe&#34; OR process_name=&#34;dllhst3g.exe&#34; OR process_name=&#34;dmcertinst.exe&#34; OR process_name=&#34;dmcfghost.exe&#34; OR process_name=&#34;dmclient.exe&#34; OR process_name=&#34;dnscacheugc.exe&#34; OR process_name=&#34;doskey.exe&#34; OR process_name=&#34;dpapimig.exe&#34; OR process_name=&#34;dpnsvr.exe&#34; OR process_name=&#34;driverquery.exe&#34; OR process_name=&#34;drvcfg.exe&#34; OR process_name=&#34;drvinst.exe&#34; OR process_name=&#34;dsregcmd.exe&#34; OR process_name=&#34;dstokenclean.exe&#34; OR process_name=&#34;dvdplay.exe&#34; OR process_name=&#34;dvdupgrd.exe&#34; OR process_name=&#34;dwm.exe&#34; OR process_name=&#34;dxdiag.exe&#34; OR process_name=&#34;easinvoker.exe&#34; OR process_name=&#34;efsui.exe&#34;;
$cond_4 = 
| from $ssa_input 
| where process_name=&#34;embeddedapplauncher.exe&#34; OR process_name=&#34;esentutl.exe&#34; OR process_name=&#34;eudcedit.exe&#34; OR process_name=&#34;eventcreate.exe&#34; OR process_name=&#34;eventvwr.exe&#34; OR process_name=&#34;expand.exe&#34; OR process_name=&#34;extrac32.exe&#34; OR process_name=&#34;fc.exe&#34; OR process_name=&#34;fhmanagew.exe&#34; OR process_name=&#34;find.exe&#34; OR process_name=&#34;findstr.exe&#34; OR process_name=&#34;finger.exe&#34; OR process_name=&#34;fixmapi.exe&#34; OR process_name=&#34;fltmc.exe&#34; OR process_name=&#34;fodhelper.exe&#34; OR process_name=&#34;fontdrvhost.exe&#34; OR process_name=&#34;fontview.exe&#34; OR process_name=&#34;forfiles.exe&#34; OR process_name=&#34;fsavailux.exe&#34; OR process_name=&#34;fsquirt.exe&#34; OR process_name=&#34;fsutil.exe&#34; OR process_name=&#34;ftp.exe&#34; OR process_name=&#34;fvenotify.exe&#34; OR process_name=&#34;fveprompt.exe&#34; OR process_name=&#34;getmac.exe&#34; OR process_name=&#34;gpresult.exe&#34; OR process_name=&#34;gpscript.exe&#34; OR process_name=&#34;gpupdate.exe&#34; OR process_name=&#34;grpconv.exe&#34; OR process_name=&#34;hdwwiz.exe&#34; OR process_name=&#34;help.exe&#34; OR process_name=&#34;hwrcomp.exe&#34; OR process_name=&#34;hwrreg.exe&#34; OR process_name=&#34;icacls.exe&#34; OR process_name=&#34;icardagt.exe&#34; OR process_name=&#34;icsunattend.exe&#34; OR process_name=&#34;ie4uinit.exe&#34; OR process_name=&#34;ieunatt.exe&#34; OR process_name=&#34;ieetwcollector.exe&#34; OR process_name=&#34;iexpress.exe&#34; OR process_name=&#34;immersivetpmvscmgrsvr.exe&#34; OR process_name=&#34;ipconfig.exe&#34; OR process_name=&#34;irftp.exe&#34; OR process_name=&#34;iscsicli.exe&#34; OR process_name=&#34;iscsicpl.exe&#34; OR process_name=&#34;isoburn.exe&#34; OR process_name=&#34;klist.exe&#34; OR process_name=&#34;ksetup.exe&#34; OR process_name=&#34;ktmutil.exe&#34; OR process_name=&#34;label.exe&#34; OR process_name=&#34;licensingdiag.exe&#34; OR process_name=&#34;lodctr.exe&#34; OR process_name=&#34;logagent.exe&#34; OR process_name=&#34;logman.exe&#34; OR process_name=&#34;logoff.exe&#34; OR process_name=&#34;lpkinstall.exe&#34; OR process_name=&#34;lpksetup.exe&#34; OR process_name=&#34;lpremove.exe&#34; OR process_name=&#34;lsass.exe&#34; OR process_name=&#34;lsm.exe&#34; OR process_name=&#34;makecab.exe&#34; OR process_name=&#34;manage-bde.exe&#34; OR process_name=&#34;mblctr.exe&#34; OR process_name=&#34;mcbuilder.exe&#34; OR process_name=&#34;mctadmin.exe&#34; OR process_name=&#34;mfpmp.exe&#34; OR process_name=&#34;mmc.exe&#34; OR process_name=&#34;mobsync.exe&#34; OR process_name=&#34;mountvol.exe&#34; OR process_name=&#34;mpnotify.exe&#34; OR process_name=&#34;msconfig.exe&#34; OR process_name=&#34;msdt.exe&#34; OR process_name=&#34;msdtc.exe&#34; OR process_name=&#34;msfeedssync.exe&#34; OR process_name=&#34;msg.exe&#34; OR process_name=&#34;mshta.exe&#34; OR process_name=&#34;msiexec.exe&#34; OR process_name=&#34;msinfo32.exe&#34; OR process_name=&#34;mspaint.exe&#34; OR process_name=&#34;msra.exe&#34; OR process_name=&#34;mstsc.exe&#34; OR process_name=&#34;mtstocom.exe&#34; OR process_name=&#34;nbtstat.exe&#34; OR process_name=&#34;ndadmin.exe&#34; OR process_name=&#34;net.exe&#34; OR process_name=&#34;net1.exe&#34; OR process_name=&#34;netbtugc.exe&#34; OR process_name=&#34;netcfg.exe&#34; OR process_name=&#34;netiougc.exe&#34; OR process_name=&#34;netsh.exe&#34; OR process_name=&#34;newdev.exe&#34; OR process_name=&#34;nltest.exe&#34; OR process_name=&#34;notepad.exe&#34; OR process_name=&#34;nslookup.exe&#34; OR process_name=&#34;ntoskrnl.exe&#34; OR process_name=&#34;ntprint.exe&#34; OR process_name=&#34;ocsetup.exe&#34; OR process_name=&#34;odbcad32.exe&#34; OR process_name=&#34;odbcconf.exe&#34; OR process_name=&#34;omadmclient.exe&#34; OR process_name=&#34;omadmprc.exe&#34;;
$cond_5 = 
| from $ssa_input 
| where process_name=&#34;openfiles.exe&#34; OR process_name=&#34;osk.exe&#34; OR process_name=&#34;p2phost.exe&#34; OR process_name=&#34;pcalua.exe&#34; OR process_name=&#34;pcaui.exe&#34; OR process_name=&#34;pcawrk.exe&#34; OR process_name=&#34;pcwrun.exe&#34; OR process_name=&#34;perfmon.exe&#34; OR process_name=&#34;phoneactivate.exe&#34; OR process_name=&#34;plasrv.exe&#34; OR process_name=&#34;poqexec.exe&#34; OR process_name=&#34;powercfg.exe&#34; OR process_name=&#34;prevhost.exe&#34; OR process_name=&#34;print.exe&#34; OR process_name=&#34;printfilterpipelinesvc.exe&#34; OR process_name=&#34;printui.exe&#34; OR process_name=&#34;proquota.exe&#34; OR process_name=&#34;provtool.exe&#34; OR process_name=&#34;psr.exe&#34; OR process_name=&#34;pwlauncher.exe&#34; OR process_name=&#34;qappsrv.exe&#34; OR process_name=&#34;qprocess.exe&#34; OR process_name=&#34;query.exe&#34; OR process_name=&#34;quser.exe&#34; OR process_name=&#34;qwinsta.exe&#34; OR process_name=&#34;rasautou.exe&#34; OR process_name=&#34;rasdial.exe&#34; OR process_name=&#34;raserver.exe&#34; OR process_name=&#34;rasphone.exe&#34; OR process_name=&#34;rdpclip.exe&#34; OR process_name=&#34;rdpinput.exe&#34; OR process_name=&#34;rdrleakdiag.exe&#34; OR process_name=&#34;recdisc.exe&#34; OR process_name=&#34;recover.exe&#34; OR process_name=&#34;reg.exe&#34; OR process_name=&#34;regedt32.exe&#34; OR process_name=&#34;regini.exe&#34; OR process_name=&#34;regsvr32.exe&#34; OR process_name=&#34;rekeywiz.exe&#34; OR process_name=&#34;relog.exe&#34; OR process_name=&#34;repair-bde.exe&#34; OR process_name=&#34;replace.exe&#34; OR process_name=&#34;reset.exe&#34; OR process_name=&#34;resmon.exe&#34; OR process_name=&#34;rmttpmvscmgrsvr.exe&#34; OR process_name=&#34;rrinstaller.exe&#34; OR process_name=&#34;rstrui.exe&#34; OR process_name=&#34;runas.exe&#34; OR process_name=&#34;rundll32.exe&#34; OR process_name=&#34;runonce.exe&#34; OR process_name=&#34;rwinsta.exe&#34; OR process_name=&#34;sbunattend.exe&#34; OR process_name=&#34;sc.exe&#34; OR process_name=&#34;schtasks.exe&#34; OR process_name=&#34;sdbinst.exe&#34; OR process_name=&#34;sdchange.exe&#34; OR process_name=&#34;sdclt.exe&#34; OR process_name=&#34;sdiagnhost.exe&#34; OR process_name=&#34;secinit.exe&#34; OR process_name=&#34;services.exe&#34; OR process_name=&#34;sessionmsg.exe&#34; OR process_name=&#34;sethc.exe&#34; OR process_name=&#34;setspn.exe&#34; OR process_name=&#34;setupcl.exe&#34; OR process_name=&#34;setupugc.exe&#34; OR process_name=&#34;setx.exe&#34; OR process_name=&#34;sfc.exe&#34; OR process_name=&#34;shadow.exe&#34; OR process_name=&#34;shrpubw.exe&#34; OR process_name=&#34;shutdown.exe&#34; OR process_name=&#34;sigverif.exe&#34; OR process_name=&#34;sihost.exe&#34; OR process_name=&#34;slui.exe&#34; OR process_name=&#34;smss.exe&#34; OR process_name=&#34;snmptrap.exe&#34; OR process_name=&#34;sort.exe&#34; OR process_name=&#34;spinstall.exe&#34; OR process_name=&#34;spoolsv.exe&#34; OR process_name=&#34;sppsvc.exe&#34; OR process_name=&#34;spreview.exe&#34; OR process_name=&#34;srdelayed.exe&#34; OR process_name=&#34;subst.exe&#34; OR process_name=&#34;svchost.exe&#34; OR process_name=&#34;sxstrace.exe&#34; OR process_name=&#34;syskey.exe&#34; OR process_name=&#34;systeminfo.exe&#34; OR process_name=&#34;systemreset.exe&#34; OR process_name=&#34;systray.exe&#34; OR process_name=&#34;tabcal.exe&#34; OR process_name=&#34;takeown.exe&#34; OR process_name=&#34;taskeng.exe&#34; OR process_name=&#34;taskhost.exe&#34; OR process_name=&#34;taskhostw.exe&#34; OR process_name=&#34;taskkill.exe&#34; OR process_name=&#34;tasklist.exe&#34; OR process_name=&#34;taskmgr.exe&#34; OR process_name=&#34;tcmsetup.exe&#34; OR process_name=&#34;timeout.exe&#34; OR process_name=&#34;tpmvscmgr.exe&#34; OR process_name=&#34;tpmvscmgrsvr.exe&#34;;
$cond_6 = 
| from $ssa_input 
| where process_name=&#34;tracerpt.exe&#34; OR process_name=&#34;tscon.exe&#34; OR process_name=&#34;tsdiscon.exe&#34; OR process_name=&#34;tskill.exe&#34; OR process_name=&#34;typeperf.exe&#34; OR process_name=&#34;tzsync.exe&#34; OR process_name=&#34;tzutil.exe&#34; OR process_name=&#34;ucsvc.exe&#34; OR process_name=&#34;unlodctr.exe&#34; OR process_name=&#34;unregmp2.exe&#34; OR process_name=&#34;upnpcont.exe&#34; OR process_name=&#34;userinit.exe&#34; OR process_name=&#34;vds.exe&#34; OR process_name=&#34;vdsldr.exe&#34; OR process_name=&#34;verclsid.exe&#34; OR process_name=&#34;verifier.exe&#34; OR process_name=&#34;verifiergui.exe&#34; OR process_name=&#34;vmicsvc.exe&#34; OR process_name=&#34;vssadmin.exe&#34; OR process_name=&#34;w32tm.exe&#34; OR process_name=&#34;waitfor.exe&#34; OR process_name=&#34;wbadmin.exe&#34; OR process_name=&#34;wbengine.exe&#34; OR process_name=&#34;wecutil.exe&#34; OR process_name=&#34;wermgr.exe&#34; OR process_name=&#34;wevtutil.exe&#34; OR process_name=&#34;wextract.exe&#34; OR process_name=&#34;where.exe&#34; OR process_name=&#34;whoami.exe&#34; OR process_name=&#34;wiaacmgr.exe&#34; OR process_name=&#34;wiawow64.exe&#34; OR process_name=&#34;wifitask.exe&#34; OR process_name=&#34;wimserv.exe&#34; OR process_name=&#34;wininit.exe&#34; OR process_name=&#34;winload.exe&#34; OR process_name=&#34;winlogon.exe&#34; OR process_name=&#34;winresume.exe&#34; OR process_name=&#34;winrs.exe&#34; OR process_name=&#34;winrshost.exe&#34; OR process_name=&#34;winver.exe&#34; OR process_name=&#34;wisptis.exe&#34; OR process_name=&#34;wkspbroker.exe&#34; OR process_name=&#34;wksprt.exe&#34; OR process_name=&#34;wlanext.exe&#34; OR process_name=&#34;wlrmdr.exe&#34; OR process_name=&#34;wowreg32.exe&#34; OR process_name=&#34;wpnpinst.exe&#34; OR process_name=&#34;wpr.exe&#34; OR process_name=&#34;write.exe&#34; OR process_name=&#34;wscript.exe&#34; OR process_name=&#34;wsmprovhost.exe&#34; OR process_name=&#34;wsqmcons.exe&#34; OR process_name=&#34;wuapihost.exe&#34; OR process_name=&#34;wuapp.exe&#34; OR process_name=&#34;wuauclt.exe&#34; OR process_name=&#34;wusa.exe&#34; OR process_name=&#34;xcopy.exe&#34; OR process_name=&#34;xpsrchvw.exe&#34; OR process_name=&#34;xwizard.exe&#34;;

| from $cond_1 
| union $cond_2 
| union $cond_3 
| union $cond_4 
| union $cond_5 
| union $cond_6 
| where match_regex(process_path, /(?i)\\windows\\system32/)=false AND match_regex(process_path, /(?i)\\windows\\syswow64/)=false 
| eval start_time=timestamp, end_time=timestamp, entities=mvappend(device, user), body=create_map([&#34;event_id&#34;, event_id, &#34;process_path&#34;, process_path, &#34;process_name&#34;, process_name]) 
| into write_ssa_detected_events();
```

#### Associated Analytic Story

* [Windows Defense Evasion Tactics](_stories/windows_defense_evasion_tactics)

* [Masquerading - Rename System Utilities](_stories/masquerading_-_rename_system_utilities)


#### How To Implement
Collect endpoint data such as sysmon or 4688 events.

#### Required field

* dest_device_id

* process_name

* _time

* dest_user_id

* process_path


#### Kill Chain Phase

* Actions on Objectives


#### Known False Positives
None



#### RBA

| Risk Score  | Impact      | Confidence   |
| ----------- | ----------- |--------------|
| 56.0 | 70 | 80 |



#### Reference


#### Test Dataset
Replay any dataset to Splunk Enterprise by using our [`replay.py`](https://github.com/splunk/attack_data#using-replaypy) tool or the [UI](https://github.com/splunk/attack_data#using-ui).
Alternatively you can replay a dataset into a [Splunk Attack Range](https://github.com/splunk/attack_range#replay-dumps-into-attack-range-splunk-server)


* [https://media.githubusercontent.com/media/splunk/attack_data/master/datasets/attack_techniques/T1036/system_process_running_unexpected_location/windows-security.log](https://media.githubusercontent.com/media/splunk/attack_data/master/datasets/attack_techniques/T1036/system_process_running_unexpected_location/windows-security.log)


_version_: 3

```
#############
# Automatically generated by doc_gen.py in https://github.com/splunk/security_content''
# On Date: 2021-09-17 11:18:22.233189 UTC''
# Author: Splunk Security Research''
# Contact: research@splunk.com''
#############
```