---
title: "AWS Network Access Control List Created with All Open Ports"
excerpt: "Disable or Modify Cloud Firewall"
categories:
  - Cloud
last_modified_at: 2021-01-11
toc: true
tags:
  - TTP
  - T1562.007
  - Disable or Modify Cloud Firewall
  - Defense Evasion
  - Splunk Security Analytics for AWS
  - Splunk Enterprise
  - Splunk Enterprise Security
  - Splunk Cloud
  - Actions on Objectives
---

# AWS Network Access Control List Created with All Open Ports

The search looks for AWS CloudTrail events to detect if any network ACLs were created with all the ports open to a specified CIDR.

- **Product**: Splunk Security Analytics for AWS, Splunk Enterprise, Splunk Enterprise Security, Splunk Cloud
- **Datamodel**:
- **ATT&CK**: [T1562.007](https://attack.mitre.org/techniques/T1562/007/)
- **Last Updated**: 2021-01-11
- **Author**: Bhavin Patel, Patrick Bareiss, Splunk


#### ATT&CK

| ID          | Technique   | Tactic       |
| ----------- | ----------- |--------------|
| T1562.007 | Disable or Modify Cloud Firewall | Defense Evasion |


#### Search

```
`cloudtrail` eventName=CreateNetworkAclEntry OR eventName=ReplaceNetworkAclEntry requestParameters.ruleAction=allow requestParameters.egress=false requestParameters.aclProtocol=-1 
| append [search `cloudtrail` eventName=CreateNetworkAclEntry OR eventName=ReplaceNetworkAclEntry requestParameters.ruleAction=allow requestParameters.egress=false requestParameters.aclProtocol!=-1 
| eval port_range=&#39;requestParameters.portRange.to&#39; - &#39;requestParameters.portRange.from&#39; 
| where port_range&gt;1024] 
| fillnull 
| stats count min(_time) as firstTime max(_time) as lastTime by userName userIdentity.principalId eventName requestParameters.ruleAction requestParameters.egress requestParameters.aclProtocol requestParameters.portRange.to requestParameters.portRange.from src userAgent requestParameters.cidrBlock 
| `security_content_ctime(firstTime)`
| `security_content_ctime(lastTime)` 
| `aws_network_access_control_list_created_with_all_open_ports_filter`
```

#### Associated Analytic Story

* [AWS Network ACL Activity](_stories/aws_network_acl_activity)


#### How To Implement
You must install the AWS App for Splunk (version 5.1.0 or later) and Splunk Add-on for AWS, version 4.4.0 or later, and configure your AWS CloudTrail inputs.

#### Required field

* _time

* eventName

* requestParameters.ruleAction

* requestParameters.egress

* requestParameters.aclProtocol

* requestParameters.portRange.to

* requestParameters.portRange.from

* requestParameters.cidrBlock

* userName

* userIdentity.principalId

* userAgent


#### Kill Chain Phase

* Actions on Objectives


#### Known False Positives
It&#39;s possible that an admin has created this ACL with all ports open for some legitimate purpose however, this should be scoped and not allowed in production environment.



#### RBA

| Risk Score  | Impact      | Confidence   |
| ----------- | ----------- |--------------|
| 48.0 | 60 | 80 |



#### Reference


#### Test Dataset
Replay any dataset to Splunk Enterprise by using our [`replay.py`](https://github.com/splunk/attack_data#using-replaypy) tool or the [UI](https://github.com/splunk/attack_data#using-ui).
Alternatively you can replay a dataset into a [Splunk Attack Range](https://github.com/splunk/attack_range#replay-dumps-into-attack-range-splunk-server)


* [https://media.githubusercontent.com/media/splunk/attack_data/master/datasets/attack_techniques/T1562.007/aws_create_acl/aws_cloudtrail_events.json](https://media.githubusercontent.com/media/splunk/attack_data/master/datasets/attack_techniques/T1562.007/aws_create_acl/aws_cloudtrail_events.json)


_version_: 2

```
#############
# Automatically generated by doc_gen.py in https://github.com/splunk/security_content''
# On Date: 2021-09-17 11:18:21.923821 UTC''
# Author: Splunk Security Research''
# Contact: research@splunk.com''
#############
```