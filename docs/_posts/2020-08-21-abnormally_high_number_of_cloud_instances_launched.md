---
title: "Abnormally High Number Of Cloud Instances Launched"
excerpt: "Cloud Accounts"
categories:
  - Cloud
last_modified_at: 2020-08-21
toc: true
tags:
  - Anomaly
  - T1078.004
  - Cloud Accounts
  - Defense Evasion
  - Persistence
  - Privilege Escalation
  - Initial Access
  - Splunk Security Analytics for AWS
  - Splunk Enterprise
  - Splunk Enterprise Security
  - Splunk Cloud
  - Change
  - Actions on Objectives
---

# Abnormally High Number Of Cloud Instances Launched

This search finds for the number successfully created cloud instances for every 4 hour block. This is split up between weekdays and the weekend. It then applies the probability densitiy model previously created and alerts on any outliers.

- **Product**: Splunk Security Analytics for AWS, Splunk Enterprise, Splunk Enterprise Security, Splunk Cloud
- **Datamodel**:[Change](https://docs.splunk.com/Documentation/CIM/latest/User/Change)
- **ATT&CK**: [T1078.004](https://attack.mitre.org/techniques/T1078/004/)
- **Last Updated**: 2020-08-21
- **Author**: David Dorsey, Splunk


#### ATT&CK

| ID          | Technique   | Tactic       |
| ----------- | ----------- |--------------|
| T1078.004 | Cloud Accounts | Defense Evasion, Persistence, Privilege Escalation, Initial Access |


#### Search

```

| tstats count as instances_launched values(All_Changes.object_id) as object_id from datamodel=Change where (All_Changes.action=created) AND All_Changes.status=success AND All_Changes.object_category=instance by All_Changes.user _time span=1h 
| `drop_dm_object_name(&#34;All_Changes&#34;)` 
| eval HourOfDay=strftime(_time, &#34;%H&#34;) 
| eval HourOfDay=floor(HourOfDay/4)*4 
| eval DayOfWeek=strftime(_time, &#34;%w&#34;) 
| eval isWeekend=if(DayOfWeek &gt;= 1 AND DayOfWeek &lt;= 5, 0, 1) 
| join HourOfDay isWeekend [summary cloud_excessive_instances_created_v1] 
| where cardinality &gt;=16 
| apply cloud_excessive_instances_created_v1 threshold=0.005 
| rename &#34;IsOutlier(instances_launched)&#34; as isOutlier 
| where isOutlier=1 
| eval expected_upper_threshold = mvindex(split(mvindex(BoundaryRanges, -1), &#34;:&#34;), 0) 
| eval distance_from_threshold = instances_launched - expected_upper_threshold 
| table _time, user, instances_launched, expected_upper_threshold, distance_from_threshold, object_id 
| `abnormally_high_number_of_cloud_instances_launched_filter`
```

#### Associated Analytic Story

* [Cloud Cryptomining](_stories/cloud_cryptomining)

* [Suspicious Cloud Instance Activities](_stories/suspicious_cloud_instance_activities)


#### How To Implement
You must be ingesting your cloud infrastructure logs. You also must run the baseline search `Baseline Of Cloud Instances Launched` to create the probability density function.

#### Required field

* _time

* All_Changes.object_id

* All_Changes.action

* All_Changes.status

* All_Changes.object_category

* All_Changes.user


#### Kill Chain Phase

* Actions on Objectives


#### Known False Positives
Many service accounts configured within an AWS infrastructure are known to exhibit this behavior. Please adjust the threshold values and filter out service accounts from the output. Always verify if this search alerted on a human user.




#### Reference


#### Test Dataset
Replay any dataset to Splunk Enterprise by using our [`replay.py`](https://github.com/splunk/attack_data#using-replaypy) tool or the [UI](https://github.com/splunk/attack_data#using-ui).
Alternatively you can replay a dataset into a [Splunk Attack Range](https://github.com/splunk/attack_range#replay-dumps-into-attack-range-splunk-server)



_version_: 2

```
#############
# Automatically generated by doc_gen.py in https://github.com/splunk/security_content''
# On Date: 2021-09-17 11:18:21.927949 UTC''
# Author: Splunk Security Research''
# Contact: research@splunk.com''
#############
```