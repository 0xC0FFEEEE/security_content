---
title: "Detect Activity Related to Pass the Hash Attacks"
excerpt: "Pass the Hash"
categories:
  - Endpoint
last_modified_at: 2020-10-15
toc: true
tags:
  - TTP
  - T1550.002
  - Pass the Hash
  - Defense Evasion
  - Lateral Movement
  - Splunk Enterprise
  - Splunk Enterprise Security
  - Splunk Cloud
  - Actions on Objectives
---

# Detect Activity Related to Pass the Hash Attacks

This search looks for specific authentication events from the Windows Security Event logs to detect potential attempts at using the Pass-the-Hash technique.

- **Product**: Splunk Enterprise, Splunk Enterprise Security, Splunk Cloud
- **Datamodel**:
- **ATT&CK**: [T1550.002](https://attack.mitre.org/techniques/T1550/002/)
- **Last Updated**: 2020-10-15
- **Author**: Bhavin Patel, Patrick Bareiss, Splunk


#### ATT&CK

| ID          | Technique   | Tactic       |
| ----------- | ----------- |--------------|
| T1550.002 | Pass the Hash | Defense Evasion, Lateral Movement |


#### Search

```
`wineventlog_security` EventCode=4624 (Logon_Type=3 Logon_Process=NtLmSsp WorkstationName=WORKSTATION NOT AccountName=&#34;ANONYMOUS LOGON&#34;) OR (Logon_Type=9 Logon_Process=seclogo) 
| fillnull 
| stats count min(_time) as firstTime max(_time) as lastTime by EventCode, Logon_Type, WorkstationName, user, dest 
| `security_content_ctime(firstTime)`
| `security_content_ctime(lastTime)` 
| `detect_activity_related_to_pass_the_hash_attacks_filter` 
```

#### Associated Analytic Story

* [Lateral Movement](_stories/lateral_movement)


#### How To Implement
To successfully implement this search, you must ingest your Windows Security Event logs and leverage the latest TA for Windows.

#### Required field

* _time

* EventCode

* Logon_Type

* Logon_Process

* WorkstationName

* user

* dest


#### Kill Chain Phase

* Actions on Objectives


#### Known False Positives
Legitimate logon activity by authorized NTLM systems may be detected by this search. Please investigate as appropriate.



#### RBA

| Risk Score  | Impact      | Confidence   |
| ----------- | ----------- |--------------|
| 49.0 | 70 | 70 |



#### Reference


#### Test Dataset
Replay any dataset to Splunk Enterprise by using our [`replay.py`](https://github.com/splunk/attack_data#using-replaypy) tool or the [UI](https://github.com/splunk/attack_data#using-ui).
Alternatively you can replay a dataset into a [Splunk Attack Range](https://github.com/splunk/attack_range#replay-dumps-into-attack-range-splunk-server)


* [https://media.githubusercontent.com/media/splunk/attack_data/master/datasets/attack_techniques/T1550.002/atomic_red_team/windows-security.log](https://media.githubusercontent.com/media/splunk/attack_data/master/datasets/attack_techniques/T1550.002/atomic_red_team/windows-security.log)


_version_: 5

```
#############
# Automatically generated by doc_gen.py in https://github.com/splunk/security_content''
# On Date: 2021-09-17 11:18:21.987508 UTC''
# Author: Splunk Security Research''
# Contact: research@splunk.com''
#############
```