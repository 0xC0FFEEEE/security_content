---
title: "Detect Windows DNS SIGRed via Splunk Stream"
excerpt: "Exploitation for Client Execution"
categories:
  - Network
last_modified_at: 2020-07-28
toc: true
tags:
  - TTP
  - T1203
  - Exploitation for Client Execution
  - Execution
  - Splunk Enterprise
  - Splunk Enterprise Security
  - Splunk Cloud
  - Exploitation
---

# Detect Windows DNS SIGRed via Splunk Stream

This search detects SIGRed via Splunk Stream.

- **Product**: Splunk Enterprise, Splunk Enterprise Security, Splunk Cloud
- **Datamodel**:
- **ATT&CK**: [T1203](https://attack.mitre.org/techniques/T1203/)
- **Last Updated**: 2020-07-28
- **Author**: Shannon Davis, Splunk


#### ATT&CK

| ID          | Technique   | Tactic       |
| ----------- | ----------- |--------------|
| T1203 | Exploitation for Client Execution | Execution |


#### Search

```
`stream_dns` 
| spath &#34;query_type{}&#34; 
| search &#34;query_type{}&#34; IN (SIG,KEY) 
| spath protocol_stack 
| search protocol_stack=&#34;ip:tcp:dns&#34; 
| append [search `stream_tcp` bytes_out&gt;65000] 
| `detect_windows_dns_sigred_via_splunk_stream_filter` 
| stats count by flow_id 
| where count&gt;1 
| fields - count
```

#### Associated Analytic Story

* [Windows DNS SIGRed CVE-2020-1350](_stories/windows_dns_sigred_cve-2020-1350)


#### How To Implement
You must be ingesting Splunk Stream DNS and Splunk Stream TCP. We are detecting SIG and KEY records via stream:dns and TCP payload over 65KB in size via stream:tcp.  Replace the macro definitions (&#39;stream:dns&#39; and &#39;stream:tcp&#39;) with configurations for your Splunk environment.

#### Required field

* _time


#### Kill Chain Phase

* Exploitation


#### Known False Positives
unknown




#### Reference


* [https://research.checkpoint.com/2020/resolving-your-way-into-domain-admin-exploiting-a-17-year-old-bug-in-windows-dns-servers/](https://research.checkpoint.com/2020/resolving-your-way-into-domain-admin-exploiting-a-17-year-old-bug-in-windows-dns-servers/)



#### Test Dataset
Replay any dataset to Splunk Enterprise by using our [`replay.py`](https://github.com/splunk/attack_data#using-replaypy) tool or the [UI](https://github.com/splunk/attack_data#using-ui).
Alternatively you can replay a dataset into a [Splunk Attack Range](https://github.com/splunk/attack_range#replay-dumps-into-attack-range-splunk-server)



_version_: 1

```
#############
# Automatically generated by doc_gen.py in https://github.com/splunk/security_content''
# On Date: 2021-09-17 11:18:22.031974 UTC''
# Author: Splunk Security Research''
# Contact: research@splunk.com''
#############
```