---
title: "Kubernetes Nginx Ingress LFI"
excerpt: "Exploitation for Credential Access"
categories:
  - Cloud
last_modified_at: 2021-08-20
toc: true
tags:
  - TTP
  - T1212
  - Exploitation for Credential Access
  - Credential Access
  - Splunk Enterprise
  - Splunk Enterprise Security
  - Splunk Cloud
  - Actions on Objectives
---

# Kubernetes Nginx Ingress LFI

This search uses the Kubernetes logs from a nginx ingress controller to detect local file inclusion attacks.

- **Product**: Splunk Enterprise, Splunk Enterprise Security, Splunk Cloud
- **Datamodel**:
- **ATT&CK**: [T1212](https://attack.mitre.org/techniques/T1212/)
- **Last Updated**: 2021-08-20
- **Author**: Patrick Bareiss, Splunk


#### ATT&CK

| ID          | Technique   | Tactic       |
| ----------- | ----------- |--------------|
| T1212 | Exploitation for Credential Access | Credential Access |


#### Search

```
`kubernetes_container_controller` 
| rex field=_raw &#34;^(?&lt;remote_addr&gt;\S+)\s+-\s+-\s+\[(?&lt;time_local&gt;[^\]]*)\]\s\&#34;(?&lt;request&gt;[^\&#34;]*)\&#34;\s(?&lt;status&gt;\S*)\s(?&lt;body_bytes_sent&gt;\S*)\s\&#34;(?&lt;http_referer&gt;[^\&#34;]*)\&#34;\s\&#34;(?&lt;http_user_agent&gt;[^\&#34;]*)\&#34;\s(?&lt;request_length&gt;\S*)\s(?&lt;request_time&gt;\S*)\s\[(?&lt;proxy_upstream_name&gt;[^\]]*)\]\s\[(?&lt;proxy_alternative_upstream_name&gt;[^\]]*)\]\s(?&lt;upstream_addr&gt;\S*)\s(?&lt;upstream_response_length&gt;\S*)\s(?&lt;upstream_response_time&gt;\S*)\s(?&lt;upstream_status&gt;\S*)\s(?&lt;req_id&gt;\S*)&#34; 
| lookup local_file_inclusion_paths local_file_inclusion_paths AS request OUTPUT lfi_path 
| search lfi_path=yes 
| rename remote_addr AS src_ip, upstream_status as status, proxy_upstream_name as proxy 
| rex field=request &#34;^(?&lt;http_method&gt;\S+)\s(?&lt;url&gt;\S+)\s&#34; 
| stats count min(_time) as firstTime max(_time) as lastTime by src_ip, status, url, http_method, host, http_user_agent, proxy 
| `security_content_ctime(firstTime)` 
| `security_content_ctime(lastTime)` 
| `kubernetes_nginx_ingress_lfi_filter`
```

#### Associated Analytic Story

* [Dev Sec Ops](_stories/dev_sec_ops)


#### How To Implement
You must ingest Kubernetes logs through Splunk Connect for Kubernetes.

#### Required field

* raw


#### Kill Chain Phase

* Actions on Objectives


#### Known False Positives
unknown



#### RBA

| Risk Score  | Impact      | Confidence   |
| ----------- | ----------- |--------------|
| 49.0 | 70 | 70 |



#### Reference


* [https://github.com/splunk/splunk-connect-for-kubernetes](https://github.com/splunk/splunk-connect-for-kubernetes)

* [https://www.offensive-security.com/metasploit-unleashed/file-inclusion-vulnerabilities/](https://www.offensive-security.com/metasploit-unleashed/file-inclusion-vulnerabilities/)



#### Test Dataset
Replay any dataset to Splunk Enterprise by using our [`replay.py`](https://github.com/splunk/attack_data#using-replaypy) tool or the [UI](https://github.com/splunk/attack_data#using-ui).
Alternatively you can replay a dataset into a [Splunk Attack Range](https://github.com/splunk/attack_range#replay-dumps-into-attack-range-splunk-server)


* [https://media.githubusercontent.com/media/splunk/attack_data/master/datasets/attack_techniques/T1212/kubernetes_nginx_lfi_attack/kubernetes_nginx_lfi_attack.log](https://media.githubusercontent.com/media/splunk/attack_data/master/datasets/attack_techniques/T1212/kubernetes_nginx_lfi_attack/kubernetes_nginx_lfi_attack.log)


_version_: 1

```
#############
# Automatically generated by doc_gen.py in https://github.com/splunk/security_content''
# On Date: 2021-09-17 11:18:22.099014 UTC''
# Author: Splunk Security Research''
# Contact: research@splunk.com''
#############
```