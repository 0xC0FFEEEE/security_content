{
  "asset_type": "Endpoint",
  "baselines": [
    {
      "id": "c914844c-0ff5-4efc-8d44-c063443129ba",
      "name": "Model Builder For \"DNS Query Length Outliers - MLTK\"",
      "product_type": "splunk"
    }
  ],
  "confidence": "low",
  "creation_date": "2019-04-29",
  "data_metadata": {
    "data_models": [
      "Network_Resolution"
    ],
    "data_source": [
      "DNS"
    ],
    "providing_technologies": [
      "Splunk Stream",
      "Bro"
    ]
  },
  "description": "This search allows you to identify DNS requests that are unusually large for the record type being requested in your environment.",
  "detect": {
    "splunk": {
      "correlation_rule": {
        "notable": {
          "nes_fields": "dest",
          "rule_description": "Identify DNS traffic with unusual query lengths",
          "rule_title": "DNS query length outliers"
        },
        "risk": {
          "risk_object": "dest",
          "risk_object_type": [
            "system"
          ],
          "risk_score": 40
        },
        "schedule": {
          "cron_schedule": "0 * * * *",
          "earliest_time": "-70m@m",
          "latest_time": "-10m@m"
        },
        "search": "| tstats `summariesonly` count from datamodel=Network_Resolution by DNS.query DNS.record_type |  `drop_dm_object_name(\"DNS\")` | eval query_length = len(query) | apply dns_query_pdfmodel threshold=0.01 | search \"IsOutlier(query_length)\" > 0 | sort -query_length",
        "suppress": {
          "suppress_fields": "query",
          "suppress_period": "43200s"
        }
      }
    }
  },
  "entities": [
    "dest"
  ]

},

"eli5": "Attackers often use random, long domain names for their attack infrastructure. This search leverages the probability distribution function algorithm provided by the Machine Learning Toolkit (MLTK) to identify outliers in the length of the DNS query for each record type observed. The companion search \"Model Builder For \"DNS Query Length Outliers - MLTK\"\" creates a machine-learning (ML) model built over historical data which is used by this search.",
  "how_to_implement": "To successfully implement this search, you will need to ensure that DNS data is populating the Network_Resolution data model. In addition, the Machine Learning Toolkit (MLTK) version 4.2 or greater must be installed on your search heads, along with any required dependencies. Finally, the support search \"Model Builder For \"DNS Query Length Outliers - MLTK\"\" must be executed before this detection search, as it builds a machine-learning (ML) model over the historical data used by this search.",
  "id": "85fbcfe8-9718-4911-adf6-7000d077a3a9",
  "investigations": [
    {
      "id": "910e6512-edc9-4f93-ba24-5b786f47a672",
      "name": "Get Process Responsible For The DNS Traffic",
      "product_type": "splunk"
    }
  ],
  "known_false_positives": "If you are seeing more results than desired, you may consider changing the value for threshold in the search to a smaller value. You should also periodically re-run the support search to re-build the ML model on the latest data.",
  "maintainers": [
    {
      "company": "Splunk",
      "email": "rvaldez@splunk.com",
      "name": "Rico Valdez"
    }
  ],
  "mappings": {
    "cis20": [
      "CIS 8",
      "CIS 12"
    ],
    "kill_chain_phases": [
      "Command and Control"
    ],
    "mitre_attack": [
      "Command and Control",
      "Exfiltration",
      "Commonly Used Port"
    ],
    "nist": [
      "PR.PT",
      "DE.AE",
      "DE.CM"
    ]
  },
  "modification_date": "2019-04-29",
  "name": "DNS Query Length Outliers - MLTK",
  "original_authors": [
    {
      "company": "Splunk",
      "email": "rvaldez@splunk.com",
      "name": "Rico Valdez"
    }
  ],
  "product_type": "splunk",
  "responses": [],
  "security_domain": "network",
  "spec_version": 2,
  "version": "1.0"
}
