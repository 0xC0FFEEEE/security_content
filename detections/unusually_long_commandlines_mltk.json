{
  "channel": "ESCU",
  "confidence": "medium",
  "correlation_rule": {
    "notable": {
      "nes_fields": "dest, process, user",
      "rule_description": "An unusually long command line $cmdline$ was found on $dest$",
      "rule_title": "Unusually Long Command Line on $dest$"
    },
    "risk": {
      "risk_object": "dest",
      "risk_object_type": [
        "system"
      ],
      "risk_score": 50
    },
    "suppress": {
      "suppress_fields": "dest,user,process",
      "suppress_period": "28800s"
    }
  },
  "creation_date": "2019-05-08",
  "data_metadata": {
    "data_models": [
      "Endpoint"
    ],
    "data_source": [
      "Endpoint Intel"
    ],
    "providing_technologies": [
      "Carbon Black Response",
      "CrowdStrike Falcon",
      "Sysmon",
      "Tanium",
      "Ziften"
    ]
  },
  "eli5": "This search leverages the machine learning toolkit (MLTK) to identify outliers in the length of the command lines observed to be used by a specific user. The companion search \"Model Builder For \"Unusually Long Command Line - MLTK\" creates an ML model built over historical data which is used by this search.",
  "how_to_implement": "You must be ingesting endpoint data that monitors command lines and populates the Endpoint data model in the Processes node. The command-line arguments are mapped to the \"process\" field in the Endpoint data model. In addition, the machine learning toolkit (MLTK) version >= 4.2 must be installed on your search heads along with any required dependencies. Finally, the support search \"Model Builder For \"Unusually Long Command Line - MLTK\"\" must be executed before this detection search, as it builds an ML model over historical data which is used by this search.",
  "known_false_positives": "Some legitimate applications start with long command lines. You should review identified command lines for legitimacy. If you are seeing more results than desired, you may consider changing the value of threshold in the search to a smaller value. You should also periodically re-run the support search to re-build the ML model on the latest data. You may get unexpected results if the user identified in the results is not present in the data used to build the associated model.",
  "maintainers": [
    {
      "company": "Splunk",
      "email": "rvaldez@splunk.com",
      "name": "Rico Valdez"
    }
  ],
  "mappings": {
    "cis20": [
      "CIS 8"
    ],
    "kill_chain_phases": [
      "Actions on Objectives"
    ],
    "mitre_attack": [
      "Execution"
    ],
    "nist": [
      "PR.PT",
      "DE.CM"
    ]
  },
  "modification_date": "2019-05-08",
  "original_authors": [
    {
      "company": "Splunk",
      "email": "rvaldez@splunk.com",
      "name": "Rico Valdez"
    }
  ],
  "scheduling": {
    "cron_schedule": "0 * * * *",
    "earliest_time": "-70m@m",
    "latest_time": "-10m@m"
  },
  "search": "| tstats `summariesonly` count min(_time) as firstTime max(_time) as lastTime FROM datamodel=Endpoint.Processes by Processes.user Processes.dest Processes.process_name Processes.process | `drop_dm_object_name(\"Processes\")` | `ctime(firstTime)`| `ctime(lastTime)`| eval processlen=len(process) | search user!=unknown | apply cmdline_pdfmodel threshold = 0.01 | search \"IsOutlier(processlen)\" = 1.0",
  "search_description": "Command lines that are extremely long can be indicative of malicious activity on your hosts. This search leverages the machine learning toolkit (MLTK) to help identify command lines with lengths that are unusual for a given user.",
  "search_id": "57edaefa-a73b-45e5-bbae-f39c1473f941",
  "search_name": "Unusually Long Command Line - MLTK",
  "search_type": "detection",
  "security_domain": "endpoint",
  "spec_version": 1,
  "version": "1.0"
}
