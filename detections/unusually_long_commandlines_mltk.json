{
  "asset_type": "Endpoint",
  "baselines": [
    {
      "id": "d2a4d85b-fc6a-47a0-82f6-bc1ec2ebc459",
      "name": "Model Builder For \"Unusually Long Command Line - MLTK\"",
      "product_type": "splunk"
    }
  ],
  "confidence": "low",
  "creation_date": "2019-04-29",
  "data_metadata": {
    "data_models": [
      "Endpoint"
    ],
    "data_source": [
      "Endpoint Intel"
    ],
    "providing_technologies": [
      "Carbon Black Response",
      "CrowdStrike Falcon",
      "Sysmon",
      "Tanium",
      "Ziften"
    ]
  },
  "description": "Command-lines that are extremely long can be indicative of malicious activity on your hosts. This search leverages the machine learning toolkit (MLTK) to help identify command lines with lengths that are unusual for a given user.",
  "detect": {
    "splunk": {
      "correlation_rule": {
        "notable": {
          "nes_fields": "dest, process, user",
          "rule_description": "An unusually long command-line $cmdline$ was found on $dest$",
          "rule_title": "Unusually Long Command-Line on $dest$"
        },
        "risk": {
          "risk_object": "dest",
          "risk_object_type": [
            "system"
          ],
          "risk_score": 50
        },
        "schedule": {
          "cron_schedule": "0 * * * *",
          "earliest_time": "-70m@m",
          "latest_time": "-10m@m"
        },
        "search": "| tstats `summariesonly` count min(_time) as firstTime max(_time) as lastTime FROM datamodel=Endpoint.Processes by Processes.user Processes.dest Processes.process_name Processes.process | `drop_dm_object_name(\"Processes\")` | `ctime(firstTime)`| `ctime(lastTime)`| eval processlen=len(process) | search user!=unknown | apply cmdline_pdfmodel threshold = 0.01 | search \"IsOutlier(processlen)\" = 1.0",
        "suppress": {
          "suppress_fields": "dest,user,process",
          "suppress_period": "28800s"
        }
      }
    }
  },
  "eli5": "This search leverages the machine learning toolkit (MLTK) to identify outliers in the length of the command lines observed to be used by a specific user. The companion search \"Model Builder For \"Unusually Long Command Line - MLTK\" creates an ML model built over historical data which is used by this search.",
  "entities": [
    "dest",
    "user",
    "process"
  ],
  "how_to_implement": "You must be ingesting endpoint data that monitors command lines and populates the Endpoint data model in the Processes node. The command-line arguments are mapped to the \"process\" field in the Endpoint data model. In addition, the machine learning toolkit (MLTK) version >= 4.2 must be installed on your search heads along with any required dependencies. Finally, the support search \"Model Builder For \"Unusually Long Command Line - MLTK\"\" must be executed before this detection search, as it builds an ML model over historical data which is used by this search.",
  "id": "57edaefa-a73b-45e5-bbae-f39c1473f941",
  "investigations": [
    {
      "id": "bc91a8cf-35e7-4bb2-8140-e756cc06fd71",
      "name": "Get Process Info",
      "product_type": "splunk"
    },
    {
      "id": "fecf2918-670d-4f1c-872b-3d7317a41bf9",
      "name": "Get Parent Process Info",
      "product_type": "splunk"
    }
  ],
  "known_false_positives": "Some legitimate applications start with long command-lines. If you are seeing more results than desired, you may consider changing the value of threshold in the search to a smaller value. You should also periodically re-run the support search to re-build the ML model on the latest data.",
  "maintainers": [
    {
      "company": "Splunk",
      "email": "rvaldez@splunk.com",
      "name": "Rico Valdez"
    }
  ],
  "mappings": {
    "cis20": [
      "CIS 8"
    ],
    "kill_chain_phases": [
      "Actions on Objectives"
    ],
    "mitre_attack": [
      "Execution"
    ],
    "nist": [
      "PR.PT",
      "DE.CM"
    ]
  },
  "modification_date": "2019-04-29",
  "name": "Unusually Long Command Line - MLTK",
  "original_authors": [
    {
      "company": "Splunk",
      "email": "rvaldez@splunk.com",
      "name": "Rico Valdez"
    }
  ],
  "product_type": "splunk",
  "responses": [],
  "security_domain": "endpoint",
  "spec_version": 2,
  "version": "1.0"
}
