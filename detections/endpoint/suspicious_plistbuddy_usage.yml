name: Suspicious PlistBuddy Usage
id: c3194009-e0eb-4f84-87a9-4070f8688f00
version: 1
date: '2021-02-22'
description: 'The following analytic identifies the use of a native MacOS utility, PlistBuddy, creating or modifying a properly list (.plist) file. In the instance of Silver Sparrow,
  the following commands were executed:
 
  
  1. PlistBuddy -c "Add :Label string init_verx" ~/Library/Launchagents/init_verx.plist\

  1. PlistBuddy -c "Add :RunAtLoad bool true" ~/Library/Launchagents/init_verx.plist\

  1. PlistBuddy -c "Add :StartInterval integer 3600" ~/Library/Launchagents/init_verx.plist\

  1. PlistBuddy -c "Add :ProgramArguments array" ~/Library/Launchagents/init_verx.plist\

  1. PlistBuddy -c "Add :ProgramArguments:1 string -c" ~/Library/Launchagents/init_verx.plist\
  
  Upon triage, capture the .plist file being written to disk and review for further indicators. Contain the endpoint and triage further.'
how_to_implement: To successfully implement this search you need to be ingesting information
  on process that include the name of the process responsible for the changes from
  your endpoints into the `Endpoint` datamodel in the `Processes` node.
  In addition, OSQuery must be installed and configured to pick up process events (info
  at https://osquery.io) as well as using the Splunk OSQuery Add-on https://splunkbase.splunk.com/app/4402.
type: batch
datamodel: []
references:
- https://redcanary.com/blog/clipping-silver-sparrows-wings/
- https://marcosantadev.com/manage-plist-files-plistbuddy/
author: Michael Haag, Splunk
search: ' |  `suspicious_plistbuddy_usage_filter`'
known_false_positives: Although unlikely, some legitimate applications may use a moved
  copy of rundll32, triggering a false positive.
tags:
  analytic_story:
  - Silver Sparrow
  mitre_attack_id:
  - T1543.001
  kill_chain_phases:
  - Actions on Objectives
  product:
  - Splunk Enterprise
  - Splunk Enterprise Security
  - Splunk Cloud
  security_domain: endpoint
  asset_type: Endpoint
  dataset:
  - https://media.githubusercontent.com/media/splunk/attack_data/master/datasets/attack_techniques/T1543.001/atomic-red-team/windows-sysmon.log
