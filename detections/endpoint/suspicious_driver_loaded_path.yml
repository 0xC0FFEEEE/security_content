name: Suspicious Driver Loaded Path
id: f880acd4-a8f1-11eb-a53b-acde48001122
version: 1
date: '2021-04-29'
author: Teoderick Contreras, Splunk
type: batch
datamodel:
- Endpoint
description: This search is to detect suspicious driver loaded path. This technique is commonly used by malware like coin miner (xmrig)
  to register its malicious driver from notable directory where executable or driver is not commonly exist.
search: '`sysmon` EventCode=6 ImageLoaded = "*.sys" NOT (ImageLoaded IN("*\\WINDOWS\\inf","*\\WINDOWS\\System32\\drivers\\*", "*\\WINDOWS\\System32\\DriverStore\\FileRepository\\*")) 
  |  stats  min(_time) as firstTime max(_time) as lastTime count by  Computer ImageLoaded Hashes IMPHASH Signature Signed
  | `security_content_ctime(firstTime)`
  | `security_content_ctime(lastTime)` 
  | `suspicious_driver_loaded_path_filter`'
how_to_implement: To successfully implement this search, you need to be ingesting
  logs with the driver loaded and Signature from your endpoints. If you are using Sysmon, you must have at least version 6.0.4 of the
  Sysmon TA. 
known_false_positives: unknown
references:
- https://www.trendmicro.com/vinfo/hk/threat-encyclopedia/malware/trojan.ps1.powtran.a/
tags:
  analytic_story:
  - xmrig
  kill_chain_phases:
  - Exploitation
  mitre_attack_id:
  - T1543.003
  product:
  - Splunk Enterprise
  - Splunk Enterprise Security
  - Splunk Cloud
  required_fields:
  - _time
  - Computer
  - ImageLoaded
  - Hashes
  - IMPHASH
  - Signature
  - Signed
  security_domain: endpoint