name: Linux Auditd Kernel Module Enumeration
id: d1b088de-c47a-4572-9339-bdcc26493b32
version: 1
date: '2024-08-27'
author: Teoderick Contreras, Splunk
status: production
type: Anomaly
description: The following analytic identifies the use of the 'kmod' process to list
  kernel modules on a Linux system. This detection leverages data from Endpoint Detection
  and Response (EDR) agents, focusing on process names and command-line executions.
  While listing kernel modules is not inherently malicious, it can be a precursor
  to loading unauthorized modules using 'insmod'. If confirmed malicious, this activity
  could allow an attacker to load kernel modules, potentially leading to privilege
  escalation, persistence, or other malicious actions within the system.
data_source:
- Linux Auditd Syscall
search: '`linux_auditd` type=SYSCALL comm=lsmod | stats count min(_time) as firstTime
  max(_time) as lastTime by comm exe  SYSCALL UID ppid pid success | `security_content_ctime(firstTime)`|
  `security_content_ctime(lastTime)` | `linux_auditd_kernel_module_enumeration_filter`'
how_to_implement: The detection is based on data that originates from Endpoint Detection
  and Response (EDR) agents. These agents are designed to provide security-related
  telemetry from the endpoints where the agent is installed. To implement this search,
  you must ingest logs that contain the process complete command-line executions.
  These logs must be processed using the appropriate Splunk Technology Add-ons that
  are specific to the EDR product. Use the Splunk Common Information Model (CIM) to
  normalize the field names and speed up the data modeling process.
known_false_positives: False positives are present based on automated tooling or system
  administrative usage. Filter as needed.
references:
- https://man7.org/linux/man-pages/man8/kmod.8.html
tags:
  analytic_story:
  - Linux Rootkit
  - Compromised Linux Host
  asset_type: Endpoint
  confidence: 50
  impact: 30
  message: $comm$ was executed on host.
  mitre_attack_id:
  - T1082
  - T1014
  observable:
  - name: comm
    type: Other
    role:
    - Victim
  product:
  - Splunk Enterprise
  - Splunk Enterprise Security
  - Splunk Cloud
  required_fields:
  - _time
  - comm
  - exe
  - SYSCALL
  - UID
  - ppid
  - pid
  risk_score: 15
  security_domain: endpoint
tests:
- name: True Positive Test
  attack_data:
  - data: https://media.githubusercontent.com/media/splunk/attack_data/master/datasets/attack_techniques/T1082/linux_auditd_lsmod/linux_auditd_lsmod.log
    source: /var/log/audit/audit.log
    sourcetype: linux:audit
    update_timestamp: true
