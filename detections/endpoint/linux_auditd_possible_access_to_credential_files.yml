name: Linux Auditd Possible Access To Credential Files
id: 0419cb7a-57ea-467b-974f-77c303dfe2a3
version: 1
date: '2024-08-27'
author: Teoderick Contreras, Splunk
status: production
type: Anomaly
description: The following analytic detects attempts to access or dump the contents
  of /etc/passwd and /etc/shadow files on Linux systems. It leverages data from Endpoint
  Detection and Response (EDR) agents, focusing on processes like 'cat', 'nano', 'vim',
  and 'vi' accessing these files. This activity is significant as it may indicate
  credential dumping, a technique used by adversaries to gain persistence or escalate
  privileges. If confirmed malicious, attackers could obtain hashed passwords for
  offline cracking, leading to unauthorized access and potential system compromise.
data_source:
- Linux Auditd Proctitle
search: '`linux_auditd` `linux_auditd_normalized_proctitle_process` | rename host as dest | where (LIKE
  (process_exec, "%shadow%") OR LIKE (process_exec, "%passwd%")) AND (LIKE (process_exec,
  "%cat %") OR LIKE (process_exec, "%nano %")OR LIKE (process_exec, "%vim %") OR LIKE
  (process_exec, "%vi %")) | stats count min(_time) as firstTime max(_time) as lastTime
  by process_exec proctitle normalized_proctitle_delimiter dest | `security_content_ctime(firstTime)`
  | `security_content_ctime(lastTime)`| `linux_auditd_possible_access_to_credential_files_filter`'
how_to_implement: The detection is based on data that originates from Endpoint Detection
  and Response (EDR) agents. These agents are designed to provide security-related
  telemetry from the endpoints where the agent is installed. To implement this search,
  you must ingest logs that contain the process complete command-line executions.
  These logs must be processed using the appropriate Splunk Technology Add-ons that
  are specific to the EDR product. Use the Splunk Common Information Model (CIM) to
  normalize the field names and speed up the data modeling process.
known_false_positives: Administrator or network operator can execute this command.
  Please update the filter macros to remove false positives.
references:
- https://askubuntu.com/questions/445361/what-is-difference-between-etc-shadow-and-etc-passwd
- https://attack.mitre.org/techniques/T1003/008/
tags:
  analytic_story:
  - Linux Privilege Escalation
  - Linux Persistence Techniques
  - Compromised Linux Host
  asset_type: Endpoint
  confidence: 50
  impact: 50
  message: $process_exec$ event occurred on host.
  mitre_attack_id:
  - T1003.008
  - T1003
  observable:
  - name: dest
    type: Endpoint
    role:
    - Victim
  product:
  - Splunk Enterprise
  - Splunk Enterprise Security
  - Splunk Cloud
  required_fields:
  - _time
  - proctitle
  risk_score: 25
  security_domain: endpoint
tests:
- name: True Positive Test
  attack_data:
  - data: https://media.githubusercontent.com/media/splunk/attack_data/master/datasets/attack_techniques/T1003.008/linux_auditd_access_credential/linux_auditd_access_credential.log
    source: /var/log/audit/audit.log
    sourcetype: linux:audit
