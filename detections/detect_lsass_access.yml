asset_type: Windows
confidence: medium
creation_date: '2018-08-28'
data_metadata:
  data_eventtypes:
    - wineventlog_sysmon
  data_source:
    - Windows Event Logs
  providing_technologies:
    - Microsoft Windows
description: This search looks for reading lsass memory consistent with credential dumping.
detect:
  splunk:
    correlation_rule:
      notable:
        nes_fields: user, dest
        rule_description: Possible attempt at credential dumping was detected on $dest$.
        rule_title: Detect reading lsass memory on $dest$.
      risk:
        risk_object: dest
        risk_object_type:
          - system
        risk_score: 40
      schedule:
        cron_schedule: 0 * * * *
        earliest_time: -70m@m
        latest_time: -10m@m
      search: source="WinEventLog:Microsoft-Windows-Sysmon/Operational" EventCode=10 TargetImage=*lsass.exe (GrantedAccess=0x1010 OR GrantedAccess=0x1410)
        | stats count min(_time) as firstTime max(_time) as lastTime by Computer, process_name, SourceImage, SourceProcessId, TargetImage, TargetProcessId, EventCode, GrantedAccess
        | rename Computer as dest
        | `ctime(firstTime)`| `ctime(lastTime)`
      suppress:
        suppress_fields: user, dest, ProcessName
        suppress_period: 86400s
eli5: This search looks for LSASS access using Credential Dumping tools by detecting Process access with
  Sysmon logs (EventCode 10), TargetImage lsass.exe and GrantedAccess 0x1410 or 0x1010.
  This will for example detect the use of sekurlsa::logonpasswords in Mimikatz.
entities:
  - dest
how_to_implement: 'This search needs Sysmon Logs and a sysmon configuration, which includes EventCode 10 with lsass.exe'
id: 2c365e57-4414-4540-8dc0-73ab10729996
known_false_positives: The activity may be legitimate. Other tools can access lsass
  for legitimate reasons, and it's possible this event could be generated
  in those cases. In these cases, false positives should be fairly obvious and you
  may need to tweak the search to eliminate noise.
maintainers:
  - company: Splunk
    email: rvaldez@splunk.com
    name: Rico Valdez
  - company: Splunk
    email: pbareiss@splunk.com
    name: Patrick Bareiss
mappings:
  cis20:
    - CIS 3
    - CIS 5
    - CIS 16
  kill_chain_phases:
    - Actions on Objectives
  mitre_attack:
    - Credential Access
    - Credential Dumping
  nist:
    - PR.IP
    - PR.AC
    - DE.CM
modification_date: '2019-12-03'
name: Detect Credential Dumping through LSASS access
original_authors:
  - company: Splunk
    email: rvaldez@splunk.com
    name: Rico Valdez
  - company: Splunk
    email: pbareiss@splunk.com
    name: Patrick Bareiss
references: []
security_domain: endpoint
spec_version: 2
type: splunk
version: "3"
