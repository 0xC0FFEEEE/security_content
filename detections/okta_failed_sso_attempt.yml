asset_type: Infrastructure
confidence: High
creation_date: '2020-04-01'
data_metadata:
  data_eventtypes:
    - okta_log
  data_source:
    - Okta
  providing_technologies:
    - Okta
description: Detect failed Okta SSO events
detect:
  splunk:
    correlation_rule:
      notable:
        nes_fields: user
        rule_description: Okta user $user$ attempted to access unauthorized app
        rule_title: Okta user SSO attempt to unauthorized app
      risk:
        risk_object: user
        risk_object_type:
          - user
        risk_score: 50
      macros:
#        - sysmon - okta?
#        - unsigned_image_loaded_by_LSASS_filter - okta_user_logins_from_multiple_cities_filter
      schedule:
        cron_schedule: 0 * * * *
        earliest_time: -70m@m
        latest_time: -10m@m
      search: 'eventtype=okta_log displayMessage="User attempted unauthorized access to app" | stats  min(_time) as firstTime max(_time) as lastTime values(app) as Apps count by user, result ,displayMessage | `security_content_ctime(firstTime)` | `security_content_ctime(lastTime)`'
      suppress:
        suppress_fields: user
        suppress_period: 86400s
eli5: This search looks for events that indicate a user attempted to access an app they did not have permissions to access. This could indicate attempts to access prohibited applications. 
entities:
  - user
how_to_implement: 'This search is specific to Okta and requires Okta logs are being ingested in your Splunk deployment.'
id: 371a6545-2618-4032-ad84-93386b8698c5
#investigations:
  - id: 5de385bf-4f1e-404e-9b67-92d162ff8938ad
    name: Investigate Previous Unseen User
    type: splunk
  - id: 097e8030-8662-4254-a735-bf0bdda696e3
    name: Investigate Failed Logins for Multiple Destinations
    type: splunk
  - id: ed3fff45-cba6-4990-983f-6fac72bee659
    name: Investigate Pass the Hash Attempts
    type: splunk
  - id: 990007ad-d798-4b29-ab2f-f0034144c937
    name: Investigate Pass the Ticket Attempts
    type: splunk
known_false_positives: There may be a faulty config preventing legitmate users from accessing apps they should have access to. 
maintainers:
  - company: Splunk
    email: rvaldez@splunk.com
    name: Rico Valdez
mappings:
  cis20:
    - CIS 16
  mitre_attack:
    - Valid Credentials
  mitre_technique_id:
    - T1078
  nist:
    - DE.CM
modification_date: '2020-04-01'
name: Okta failed SSO attempts
original_authors:
  - company: Splunk
    email: rvaldez@splunk.com
    name: Rico Valdez
#references:
  - https://2017.zeronights.org/wp-content/uploads/materials/ZN17_Kheirkhabarov_Hunting_for_Credentials_Dumping_in_Windows_Environment.pdf
security_domain: access
spec_version: 2
type: splunk
version: "1"
