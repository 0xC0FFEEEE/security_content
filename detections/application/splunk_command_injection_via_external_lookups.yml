name: Splunk Command Injection via external lookups
id: 854e39a9-1c7d-4129-b189-ff6335d80c3c
version: 1
date: '2023-08-21'
author: Rod Soto
status: production
type: Hunting
data_source: []
description: This hunting search provides data on finding exploit attempts in Splunk Enterprise versions below 8.2.12, 9.0.6, and 9.1.1, an attacker can create an external lookup that calls a legacy internal function. The attacker can use this internal function to insert code into the Splunk platform installation directory. From there, a user can execute arbitrary code on the Splunk platform Instance.
search: '| `splunkd_ui` method=POST uri_path="/en-US/splunkd/__raw/servicesNS/*/search/configs*" | stats count by host method uri_path clientip | `splunk_command_injection_via_external_lookups_filter`'
how_to_implement: This search requires web enabled interface and ability to search internal indexes. 
known_false_positives: ???
references:
- https://advisory.splunk.com/
tags:
  analytic_story:
  - Splunk Vulnerabilities
  asset_type: endpoint
  confidence: 50
  impact: 50
  message: Possible command injection attack against $host$
  mitre_attack_id:
  - T1202
  observable:
  - name: host
    type: Hostname
    role:
    - Victim
  product:
  - Splunk Enterprise
  - Splunk Enterprise Security
  - Splunk Cloud
  risk_score: 25
  required_fields:
  - method 
  - host
  - uri_path 
  - clientip 
  security_domain: endpoint
tests:
- name: True Positive Test
  attack_data:
  - data: data/SPL-230071.txt
    source: splunkd_ui_access.log
    sourcetype: splunkd_ui_access
    custom_index: _internal