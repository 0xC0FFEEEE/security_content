name: Azure AD AzureHound UserAgent Detected
id: d62852db-a1f1-40db-a7fc-c3d56fa8bda3
version: 1
date: '2025-01-06'
author: Dean Luxton
data_sources:
- Azure Active Directory NonInteractiveUserSignInLogs
- Azure Active Directory MicrosoftGraphActivityLogs
type: TTP
status: production
description: This detection looks for the default AzureHound useragent string within Graph Activity logs and NonInteractive SignIn Logs. 
search: >-
  `azure_monitor_aad` category IN (MicrosoftGraphActivityLogs, NonInteractiveUserSignInLogs) properties.userAgent=azurehound*
  | eval createdDateTime=strptime('properties.createdDateTime',"%Y-%m-%dT%H:%M:%S.%7Q%z")
  | stats min(createdDateTime) as _time values(user_agent) as user_agent values(user) as user count values(src_category) as src_category by src tenantId
  | iplocation src
  | `azure_ad_azurehound_useragent_detected_filter`
how_to_implement: The Splunk Add-on for Microsoft Cloud Services add-on is required to ingest NonInteractiveUserSignInLogs and MicrosoftGraphActivityLogs via an Azure EventHub. See reference for links for further details. 
known_false_positives: None
references:
- https://github.com/SpecterOps/AzureHound
- https://splunkbase.splunk.com/app/3110
- https://docs.splunk.com/Documentation/AddOns/released/MSCloudServices/Install
tags:
  analytic_story:
  - Azure Active Directory Privilege Escalation
  - Compromised User Account
  asset_type: Azure Tenant
  confidence: 100
  impact: 80
  message: AzureHound UserAgent String $user_agent$ Detected on Tenant $tenantId$
  mitre_attack_id:
  - T1087.004
  - T1526
  observable:
  - name: src
    type: IP Address
    role:
    - Attacker
  - name: user
    type: User
    role:
    - Attacker
  - name: user_agent
    type: User Agent
    role:
    - Attacker
  product:
  - Splunk Enterprise
  - Splunk Enterprise Security
  - Splunk Cloud
  required_fields:
  - src
  - category
  - properties.userAgent
  - tenantId
  risk_score: 80
  security_domain: identity
tests:
- name: True Positive Test
  attack_data:
  - data: https://github.com/splunk/contentctl/wiki
    sourcetype: UPDATE SOURCETYPE
    source: UPDATE SOURCE
