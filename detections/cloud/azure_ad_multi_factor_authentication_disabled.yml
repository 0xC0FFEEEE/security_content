name: Azure AD Multi-Factor Authentication Disabled
id: 482dd42a-acfa-486b-a0bb-d6fcda27318e
version: 1
date: '2022-08-10'
author: Mauricio Velazco, Splunk
type: TTP
datamodel: []
description: The following analytic identifies an attempt to disable the MFA for a user. The attackers may disbale MFA after they acquire the credentials for the password.
  This way the attackers can keep persistance in the environment without adding new users. Sometimes, the MFA may be disbaled by administrator for genuine purposes.
search: '`azuread` | spath "body.operationName" | search "body.operationName"="Disable Strong Authentication" 
  | rename body.properties.* as * | spath "body.properties.targetResources{}.userPrincipalName" | rename initiatedBy.user.ipAddress as ipAddress  
  | stats  values(body.properties.targetResources{}.userPrincipalName) as userPrincipalName by _time, userAgent, ipAddress | `azure_ad_multi_factor_authentication_disabled_filter`'
how_to_implement: You must install the latest version of  Splunk Add-on for Microsoft Cloud Services from  Splunkbase(https://splunkbase.splunk.com/app/3110/#/details). You must be ingesting Azure Active Directory events into your Splunk environment. You must be ingesting Azure Active Directory events in your Splunk environment. Specifically, this analytic leverages the RiskyUsers and UserRiskEvents
  log category.
known_false_positives: Legitimate users may disable MFA for debugging or testing.
references:
- https://docs.microsoft.com/en-us/azure/active-directory/authentication/concept-mfa-howitworks
- https://attack.mitre.org/tactics/TA0005/
tags:
  analytic_story:
  - Azure Active Directory Account Takeover
  asset_type: Azure Active Directory
  cis20:
  - CIS 3
  - CIS 5
  - CIS 16
  confidence: 90
  context:
  - Source:Cloud Data
  - Stage:Initial Access
  dataset:
  - https://media.githubusercontent.com/media/splunk/attack_data/master/datasets/attack_techniques/T1003.002/azuread/azure-audit.log
  impact: 60
  kill_chain_phases:
  - Installation
  - Actions on Objectives
  message: MFA disabled for User $body.properties.targetResources{}.userPrincipalName$
  mitre_attack_id:
  - T1003.002
  nist:
  - DE.CM
  observable:
  - name: userPrincipalName
    type: User
    role:
    - Victim
  - name: ipAddress
    type: IP Address
    role:
    - Attacker
  product:
  - Splunk Enterprise
  - Splunk Enterprise Security
  - Splunk Cloud
  required_fields:
  - _time
  - body.properties.targetResources{}.userPrincipalName
  - body.properties.initiatedBy.user.ipAddress
  - body.properties.userAgent
  risk_score: 54
  security_domain: identity
