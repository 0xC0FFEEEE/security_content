author: "Rod Soto, Splunk"
date: "2020-10-27"
description: "This search provides detection of accounts creating KMS with encrypt policy and without using MFA."
how_to_implement: "You must install splunk AWS add on and Splunk App for AWS. This search works with clodtrail logs"
id: c79c164f-4b21-4847-98f9-cf6a9f49179e
known_false_positives: "Not all KMS key creations are malicious. Particulary look for kms:Encryp only. It is very unusual to create a key to encrypt only and not to decrypt."
name: "aws detect users creating keys with encrypt policy without mfa"
references: []
search: 'sourcetype:aws:cloudtrail eventName=CreateKey userIdentity.sessionContext.attributes.mfaAuthenticated=false | spath Parameters.policy=*kms.Encrypt*  |table userIdentity.sessionContext.attributes.creationDate userIdentity.sessionContext.attributes.mfaAuthenticated user user_access_key requestParameters.keyUsage responseElements.keyMetadata.arn
 |`aws_detect_users_creating_keys_with_encrypt_policy_without_mfa_filter`'
tags:
  analytics_story:
    - "Ransomware Cloud"
  asset_type: "AWS Account"
  mitre_attack_id:
    - T1486
  security_domain: threat
type: ESCU
version: 1
