{
  "asset_type": "Endpoint",
  "channel": "ESCU",
  "confidence": "high",
  "creation_date": "2019-07-21",
  "data_metadata": {
    "data_models": [
      "Email"
    ],
    "data_source": [
      "Email"
    ],
    "providing_technologies": [
      "Microsoft Exchange"
    ]
  },
  "description": "Emails that are suspicious due to sender, domain rareness or behavior differences. This is an anomaly generated by Splunk> User Behavior Analytics product.",
  "detect": {
    "uba": {
      "correlation_rule": {
        "notable": {
          "nes_fields": "src_user, file_name",
          "rule_description": "The sender $src_user$ has sent an email with a suspicious amount of spaces in the file name: $file_name$",
          "rule_title": "Suspicious Email Attachment from $src_user$"
        },
        "risk": {
          "risk_object": "src_user",
          "risk_object_type": [
            "user"
          ],
          "risk_score": 60
        },
        "schedule": {
          "cron_schedule": "0 * * * *",
          "earliest_time": "-70m@m",
          "latest_time": "-10m@m"
        },
        "search": "|tstats count values(All_UEBA_Events.UEBA_Anomalies.uba_model) from datamodel=UEBA where nodename=All_UEBA_Events.UEBA_Anomalies by sourcetype All_UEBA_Events.description All_UEBA_Events.dvc All_UEBA_Events.user",
        "suppress": {
          "suppress_fields": "src_user",
          "suppress_period": "86400s"
        }
      },
      "event_type": "anomaly",
      "model": "Suspicious Email Detection Model",
      "model_version": "4.2",
      "threat_category": "Email"
    }
  },
  "eli5": "This search looks at any emails with file attachment names that contain many spaces, relative to the length of the file name. Specifically, it checks to see whether spaces make up more than 10% of the number of characters in the file name. This percentage can be tuned for each environment. The search will output the message ID of the email, the count, the sender and recipient addresses, the first and last time this event was seen, and the space ratio of the file attachment name.",
  "entities": [
    "src",
    "message_id"
  ],
  "how_to_implement": "You need to ingest data from emails. Specifically, the sender's address and the file names of any attachments must be mapped to the Email data model. The threshold ratio is set to 10%, but this value can be configured to suit each environment. <br></br> <b>Splunk Phantom Playbook Integration</b><br></br>If Splunk Phantom is also configured in your environment, a playbook called \"Suspicious Email Attachment Investigate and Delete\" can be configured to run when any results are found by this detection search. To use this integration, install the Phantom App for Splunk <code>https://splunkbase.splunk.com/app/3411/</code> and add the correct hostname to the \"Phantom Instance\" field in the Adaptive Response Actions when configuring this detection search. The notable event will be sent to Phantom and the playbook will gather further information about the file attachment and its network behaviors. If Phantom finds malicious behavior and an analyst approves of the results, the email will be deleted from the user's inbox.",
  "id": "56e877a6-1455-4479-ada6-0550dc1e33f8",
  "investigations": [
    {
      "id": "3096f721-8842-42ce-2fc7-742d8372b712",
      "name": "Suspicious Email Attachment Investigate and Delete",
      "product_type": "phantom"
    }
  ],
  "known_false_positives": "None at this time",
  "maintainers": [
    {
      "company": "Splunk",
      "email": "bpatel@splunk.com",
      "name": "Bhavin Patel"
    }
  ],
  "mappings": {
    "cis20": [
      "CIS 7"
    ],
    "kill_chain_phases": [
      "Delivery"
    ],
    "mitre_attack": [],
    "nist": [
      "PR.IP"
    ]
  },
  "modification_date": "2019-07-21",
  "name": "Suspicious Email - UBA Anomaly",
  "original_authors": [
    {
      "company": "Splunk",
      "email": "bpatel@splunk.com",
      "name": "Bhavin Patel"
    }
  ],
  "product_type": "uba",
  "security_domain": "threat",
  "spec_version": 2,
  "version": "2.0"
}
