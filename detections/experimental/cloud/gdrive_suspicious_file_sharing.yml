name: Gdrive suspicious file sharing
id: a7131dae-34e3-11ec-a2de-acde48001122
version: 1
date: '2021-10-24'
author: Rod Soto, Teoderick Contreras
type: Anomaly
datamodel: []
description: This search can help the detection of compromised accounts or internal,external users sending malicious documents via GSuite file sharing.
search: 'source="http:gsuite" name=change_user_access parameters.target_user = "*yourdomain*" parameters.owner !="*yourdomain.com"
| spath "parameters.owner"
| search "parameters.owner"="*"
| stats  count values("parameters.owner") as owner values("parameters.target_user") as target dc("parameters.target_user") as distinct_target by src_ip parameters.doc_type parameters.doc_title |where count > 100 | `gdrive_suspicious_file_sharing_filter`'
how_to_implement: Need to implement Gsuite logging targeting Google suite drive activity.
known_false_positives: This is an anomaly search, you must specify your domain in the parameters so it either filters outside domains or focus on internal domains. This search may also help investigate compromise of accounts. By looking at for example source ip addresses, document titles and abnormal number of shares and shared target users.
references:
- https://www.splunk.com/en_us/blog/security/investigating-gsuite-phishing-attacks-with-splunk.html
tags:
  analytic_story:
  - Spearphishing Attachments
  dataset:
  - []
  kill_chain_phases:
  - Exploitation
  mitre_attack_id:
  - T1566
  product:
  - Splunk Enterprise
  - Splunk Enterprise Security
  - Splunk Cloud
  required_fields:
  - _time
  - src_ip
  - parameters.owner
  - parameters.target_user
  - parameters.doc_title
  - parameters.doc_type
  security_domain: threat
