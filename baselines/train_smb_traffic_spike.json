{
  "channel": "ESCU",
  "creation_date": "2019-05-08",
  "data_metadata": {
    "data_models": [
      "Network_Traffic"
    ],
    "data_source": [
      "Network Communications"
    ],
    "providing_technologies": [
      "Splunk Stream",
      "Bro"
    ]
  },
  "eli5": "Create a machine-learning (ML) model to characterize the number of SMB connections observed in your environment. This may help identify spikes in SMB traffic that can be indicative of attackers scanning or attempting to propagate to other systems in your environment.",
  "how_to_implement": "To successfully implement this search, you must be ingesting network traffic and populating the Network_Traffic data model. In addition, you must have the Machine Learning Toolkit (MLTK) version >= 4.2 installed, along with any required dependencies. You may also want to periodically re-run this search to rebuild the model with the latest data.",
  "maintainers": [
    {
      "company": "Splunk",
      "email": "rvaldez@splunk.com",
      "name": "Rico Valdez"
    }
  ],
  "modification_date": "2019-05-08",
  "original_authors": [
    {
      "company": "Splunk",
      "email": "rvaldez@splunk.com",
      "name": "Rico Valdez"
    }
  ],
  "scheduling": {
    "earliest_time": "-31d@d",
    "latest_time": "-1d@d"
  },
  "search": "| tstats `summariesonly` count from datamodel=Network_Traffic where All_Traffic.dest_port=139 OR All_Traffic.dest_port=445 OR All_Traffic.app=smb by _time span=10m, All_Traffic.src | eval HourOfDay=strftime(_time, \"%H\") | eval DayOfWeek=strftime(_time, \"%A\") | `drop_dm_object_name(\"All_Traffic\")` | fit DensityFunction count by \"HourOfDay,DayOfWeek,src\" into smb_pdfmodel",
  "search_description": "This search is used to build a Machine Learning Toolkit (MLTK) model to characterize the number of SMB connections observed each hour for every day of week. By default, the search uses the last 30 days of data to build the model. The model created by this search is then used in the corresponding detection search, which uses it to identify outliers in the number of SMB connections for that hour and day of the week.",
  "search_id": "df98763b-0b08-4281-8ef9-08db7ac572a9",
  "search_name": "Model Builder For \"SMB Traffic Spike - MLTK\"",
  "search_type": "support",
  "spec_version": 1,
  "version": "1.0"
}
